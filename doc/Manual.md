# TensorAlloy Manual

* Author: Xin Chen
* Email: Bismarrck@me.com
* Version: `1.0`
* Date: Dec 22, 2018

## 1. Program

The `tensoralloy` program has two subcommands:

* `build`: build a _sqlite3_ database from a _xyz_ or _extxyz_ file.
* `run`: run an experiment from a TOML input file.

### 1.1 Subcommand: build

The `build` comamnd is used to build a 
[ase.db](https://wiki.fysik.dtu.dk/ase/ase/db/db.html#module-ase.db.core).

**Usage**

```bash
tensoralloy build filename [-h] 
                           [--num-examples NUM_EXAMPLES] 
                           [--energy-unit ENERGY_UNIT] 
                           [--forces-unit FORCES_UNIT] 
                           [--stress-unit STRESS_UNIT]
```

**Args:**

* `filename`: a _xyz_ file or an _extxyz_ file. Please refer to 
    [ase.io.write](https://wiki.fysik.dtu.dk/ase/ase/io/io.html#module-ase.io) 
    for more information.
* `--num-examples`: the total number of examples to read. If not set, all 
    structures in the file will be read.
* `--energy-unit`: the unit of the total energies, possible options: 
    _eV_ (default), _Hartree_ or _kcal/mol_.
* `--forces-unit`: the unit of the atomic forces, possible options: 
    _eV/Angstrom_ (default), _eV/Bohr_, _Hartree/Angstrom_, _Hartree/Bohr_,
    _kcal/mol/Angstrom_ or _kcal/mol/Bohr_.
* `--stress-unit`: the unit of the stress tensors, possible options: 
    _GPa_ (default) or _kbar_.

**Example**

```bash
tensoralloy build datasets/qm7.xyz --energy-unit=Hartree
```

### 1.2 Subcommand: run

The subcommand `run` is used to run an experiment given a 
[TOML](https://github.com/toml-lang/toml) input file. Section 2 will introduce 
the input file. 

**Usage**

```bash
tensoralloy run input_file
```

**Args**

* `input_file`: a TOML input file.

**Example**

```bash
export PYTHONPATH=`pwd`:$PYTHONPATH
cd test_files/inputs
tensoralloy run qm7.behler.k2.toml
```

## 2. Input

### [dataset]

* `sqlite3`
    - The [ase.db](https://wiki.fysik.dtu.dk/ase/ase/db/db.html#module-ase.db.core) 
      to use. This database should be generated by command `tensoralloy build`.
    - type: string
    - required: true
* `name`
    - The name of this experiment. Note: the character '-' is not allowed.
    - type: string
    - required: true
* `descriptor`
    - The selected descriptor to describe this dataset. Options: _'eam'_ or
      _'behler'_
    - type: string
    - required: true
* `rc`
    - The cutoff radius, in Angstroms.
    - type: float
    - default: 6.5
* `tfrecords_dir`
    - The directory to save/load generated tfrecords files.
    - type: string
    - default: "."
* `test_size`
    - The size of the evalutaion dataset. This can be an `int` (the absolute 
      size, e.g. 1000) or a `float` (the fraction, e.g. 0.2).
    - type: int or float
    - default: 0.2

### [nn]

* `activation`
    - The activation function to use: _'leaky_relu'_, _'relu'_, _'elu'_, 
      _'tanh'_ or _'sigmoid'_.
    - type: string
    - default: 'leaky_relu'
* `l2_weight`
    - The weight of the L2 regularization term. If zero, L2 regularization will
      be disabled. 
    - type: float
    - default: 0.0
* `minimize`
    - Specify the structural properties to minimize. Should be a list of str.   
      Keys are: _'energy'_, _'forces'_, _'stress'_ or _'total_pressure'_
    - type: List\[str\]
    - default: \['energy', 'forces'\]
* `predict`
    - Specify the structural properties to predict. Should be a list of str. 
      Keys are the same with `minimize`.
    - type: List\[str\]
    - default: \['energy', 'forces'\]

### [nn.atomic]

**Note**: This section is only 

* `arch`
    - 
    - type: string
    - default: 'AtomicNN'
* `input_normalizer`
    -
    - type: string or false
    - default: 'linear'

### [nn.atomic.layers]

**Note**: This section is only 

### [nn.eam]

**Note**: This section is only 

* `arch`
    -
    - type: string
    - default: `EamAlloyNN`

### [nn.eam.rho]

### [nn.eam.phi]

### [nn.eam.embed]

### [nn.eam.export]

* `nr`
    - 
    - type: int
    - default: 10000
* `dr`
    -
    - type: float
    - default: 0.00065
* `nrho`
    -
    - type: int
    - default: 10000
* `drho`
    -
    - type: float
    - default: 0.001

### [opt]

* `method`
    -
    - type: string
    - default: 'adam'
* `learning_rate`
    -
    - type: float
    - default: 0.01
* `decay_function`
    -
    - type: string or false
    - default: false
* `decay_rate`
    -
    - type: float
    - default: 0.95
* `decay_steps`
    -
    - type: int
    - default: 1000
* `staircase`
    -
    - type: string or false
    - default: false

### [train]

* `restart`
    -
    - type: string or false
    - default: false
* `batch_size`
    -
    - type: int
    - default: 50
* `previous_checkpoint`
    -
    - type: string or false
    - default: false
* `shuffle`
    -
    - type: boolean
    - default: false
* `model_dir`
    -
    - type: string
    - required
* `max_checkpoints_to_keep`
    -
    - type: int
    - default: 20
* `train_steps`
    -
    - type: int
    - default: 10000
* `eval_steps`
    -
    - type: int
    - default: 1000
* `summary_steps`
    -
    - type: int
    - default: 100
* `log_steps`
    -
    - type: int
    - default: 100
* `profile_steps`
    -
    - type: int
    - default: 2000
