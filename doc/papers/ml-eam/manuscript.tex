
\documentclass[prb,reprint]{revtex4-2}

\usepackage{amsmath}    % need for subequations
\usepackage{graphicx}   % need for figures
\usepackage{verbatim}   % useful for program listings
\usepackage{color}      % use if color is used in text
\usepackage{subfigure}  % use for side-by-side figures
\usepackage{hyperref}   % use for hypertext links, including those to external
\raggedbottom           % don't add extra vertical space
\begin{comment}
\end{comment}

\bibliographystyle{apsrev4-2}

\begin{document}

\title{
    Machine-learned embedded atom method
}

\author{Xin Chen, 
        Li-Fang Wang, 
        De-Ye Lin$^\mathrm{*}$, 
        Hai-Feng Song$^\mathrm{*}$}

\affiliation{
    Institute of Applied Physics and Computational Math, 
    Beijing 100088, China}

\affiliation{
    CAEP Software Center for High Performance Numerical Simulation, 
    Beijing 100088, China}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% 
% Abstract
%
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\begin{abstract}
\end{abstract}

\maketitle

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% 
% Section 1. Introduction
%
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\section{Introduction}
\label{sec:introduction}

Atomistic modeling plays a vital role in materials science. \textit{ab initio} 
calculation or force-field based molecular dynamics simulation (MD) are 
effective ways to study, understand or predict chemical and physical properties 
of materials. \textit{ab initio} approaches are generally much more precise but 
they are rarely used on large-scale metallic systems due to their extremely-high 
computation expenses. Physical model based empirical potential (force-field), 
such as the embedded-atom method (EAM), modified embedded-atom method (MEAM), 
bond-order potential (BoP), or angular-dependent potential (ADP), still plays 
the major role in long-time simulations and these empirical methods can achieve 
reasonable accuracy with much lower computation costs. Empirical potentials 
generally have very few learnable parameters and traditionally both microscopic 
observables (energy, forces, virial, etc.) and macroscopic observables (melting 
point, surface energy, etc.) can be used to tune these parameters.

In the last decade, machine learning (ML) has become one of the hottest 
topics in many research areas. In the materials science, researchers have made 
great efforts on developing ML models to describe atomic interactions. Such ML 
models are considered as machine learning interaction potentials (MLIPs). Until 
now, hundreds of MLIPs have been proposed. Among them, the symmetry-function 
based atomistic neural network (ANN) model by Parinello and Behler is the most 
popular choice in modeling metallic interactions. The smooth overlap atomic 
positions descriptor based gaussian approximation potential (SOAP-GAP) can give
extremely accurate results, although it's a bit computationally expensive. 
Spectral neighbor analysis potential (SNAP) is another quantum-accurate MLIP and
it performs very well on a broad range of metals and alloys. 

Compared with empirical potentials, MILPs typically have several orders of 
magnitudes more model parameters. The redundant parameter space greatly reduces 
the difficulty of fitting complicated potential energy surfaces with MLIPs. 
However, it also raises some new challenges. To effectively train MLIPs with 
large numbers of parameters, typically tens of thousands high-quality 
\textit{ab initio} data points are necessary. The cost of building training 
datasets can not be ignored. The lack of physical background makes the 
performances of MILPs outside the training 'zone' not stable. For large-scale 
alloy systems, computation efficiency becomes a major concern.  

Traditionally, to find optimal parameters of an EAM potential, global 
optimization approaches (such as Basin Hopping or Genetic Algorithm) will be 
used because the analytical gradients of the total loss with respect to model
parameters are difficult to derive and implement \textit{by hand}. In this 
paper, we chose a new route to address this issue: to 'ask' machine learning 
platform to handle derivations and implementations. 

This paper is organized as follows. Section \ref{sec:method} describes the 
theoretical background of this work, including the formalism of the embedded 
atom method, the expressions of the empirical potential and the algorithms for 
integrating EAM with machine learning. Section \ref{sec:results} summarizes the 
training results and the optimal parameters. Applications of the new potentials 
are discussed in Section \ref{sec:discussions}. Technical details can be found 
in the appendix.

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% 
% Section 2. Method
%
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\section{Method}
\label{sec:method}


% ------------------
% Section 2.1 Theory
% ------------------
\subsection{Theory}
\label{sec:theory}

In the original EAM formalism, the total energy, $E^{total}$, is the sum of 
atomic energies:
\begin{align}
E^{total} = & \sum_{i}^{N}{E_{i}} \nonumber \\
\label{eq:eam_total_energy}
= & \sum_{i}^{N}{F_{a}(\rho_i)} + 
    \frac{1}{2}\sum_{i}^{N}{\sum_{j \neq i}^{r_{ij} < r_c}{
    \phi_{ab}(r_{ij})
}}
\end{align}
where $r_c$ is the cutoff radius, $a$ and $b$ represents species of atoms $i$ 
and $j$, $\phi_{ab}(r_{ij})$ is energy of the pairwise interaction between $i$ 
and $j$, $F_{a}(\rho_{i})$ is the embedding energy and $\rho_{i}$ is the local 
electron density. Typically, $\rho_{i}$ can be calculated with the following 
equation:
\begin{equation}
\label{eq:rho_eam}
\rho_{i} = \sum_{j}^{r_{ij} < r_{c}}{
    \rho_{b}(r_{ij})
}
\end{equation}
where $\rho_{b}$ is the electron density function of specie $b$. In the 
Finnis-Sinclair model, the electron density has a slightly modified form:
\begin{equation}
\label{eq:rho_fs}
\rho_{i}^{\mathrm{FS}} = \sum_{j}^{r_{ij} < r_{c}}{
    \rho_{ab}(r_{ij})
}
\end{equation}

The original EAM potential does not inlcude angular-dependent interactions. To 
fix this problem, Baskes modified the original EAM and got MEAM (modified 
embedded-atom method), Lenosky proposed an alternative spline-based interpretion 
of MEAM  while Mishin developed the angular-dependent potential (ADP). The ADP 
formalism introduces three additional terms to the total energy:
\begin{align}
\label{eq:adp}
E^{total} 
& = E^{\mathrm{EAM}} \nonumber \\
& + \frac{1}{2}\sum_{i}{\sum_{\alpha}{(\mu_{i}^{\alpha})^2}} \nonumber \\
& + \frac{1}{2}\sum_{i}{
    \sum_{\alpha}{\sum_{\beta}{(\lambda_{i}^{\alpha\beta})^2}}} \nonumber \\
& - \frac{1}{6}\sum_{i}{\nu_{i}^{2}}
\end{align}
These terms represent non-central bonding contributions and they can be computed
with the following equations:
\begin{align}
\label{eq:adp_mu}
\mu_{i}^{\alpha} & = \sum_{j \neq i}{\mu_{ab}(r_{ij}) r_{ij}^{\alpha}} \\
\label{eq:adp_lambda}
\lambda_{i}^{\alpha\beta} & = \sum_{j \neq i}{
    \omega_{ab}(r_{ij}) r_{ij}^{\alpha}r_{ij}^{\beta}} \\
\label{eq:adp_nu}
\nu_{i} & = \sum_{\alpha}{\lambda_{i}^{\alpha\alpha}}
\end{align}
where $\mu_{ab}(r)$ and $\omega_{ab}(r)$ can be viewed as measures of the 
strengths of dipole and quadrupole interactions.

In this work, we use the EAM potential published by Zhou, Johnson and Wadley 
(Zjw04) as an example to validate our machine learning approach. Zjw04 is a 
quite popular EAM potential and it is applicable to a number of metals and 
alloys. In the Zjw04 model, the electron density function has the following 
form:
\begin{equation}
\label{eq:zjw04_rho}
\rho_{b}(r) = \frac{
    f_{e} \exp\left[ -\beta\left( r/r_{e} - 1 \right) \right]
}{
    1 + \left(r/r_{e} - \lambda\right)^{20}
}
\end{equation}
where $r_e$ is a constant equal to equilibrium spacing between nearest neighors, 
$f_{e}$, $\beta$, $\lambda$ are adjustable parameters. The pairwise potential 
between the same species can be computed with:
\begin{equation}
\label{eq:zjw04_phi_aa}
\phi_{aa}(r) = 
\frac{A \exp\left[ -\alpha\left( r/r_{e} - 1 \right) \right]}
     {1 + \left(r / r_{e} - \kappa\right)^{20}} - 
\frac{B \exp\left[ -\beta\left( r/r_{e} - 1 \right) \right]}
     {1 + \left(r / r_{e} - \lambda\right)^{20}}
\end{equation}
where $A$, $\alpha$ and $\kappa$ are also trainable parameters, $B$, $\beta$ and 
$\kappa$ are used in Equation \ref{eq:zjw04_rho} already. For the pairwise 
interaction between two atoms of different species, Zhou et al proposed an 
interpolation form:
\begin{equation}
\label{eq:zjw04_phi_ab}
\phi_{ab}(r) = \frac{1}{2}\left(
    \frac{\rho_{b}(r)}{\rho_{a}(r)}\phi_{aa}(r) +
    \frac{\rho_{a}(r)}{\rho_{b}(r)}\phi_{bb}(r) 
\right)
\end{equation}
The embedding function has a more complicated form as it requires to fit a much 
wider range of electron density values:
\begin{equation}
\label{eq:zjw04_embed}
F(\rho) = \begin{cases}
    \sum_{i=0}^{3}{F_{ni}\left( \frac{\rho}{\rho_n} - 1 \right)^{i}} &
    \rho < \rho_{n} \\
    \sum_{i=0}^{3}{F_{i}\left( \frac{\rho}{\rho_e} - 1 \right)^{i}} &
    \rho_{n} \leq \rho < \rho_{0} \\
    F_{e}\left[ 
        1 - \eta\ln\left( \frac{\rho}{\rho_s}\right) 
    \right](\frac{\rho}{\rho_s})^{\eta} & \rho_{0} \leq \rho
\end{cases}
\end{equation}
where $F_{ni}$, $F_{i}$, $\rho_e$, $\rho_s$, $\eta$ and $F_{e}$ are trainable 
parameters, $\rho_n=0.85\rho_e$ and $\rho_0=1.15\rho_e$. For each metal, there 
are 15 adjustable parameters. The original embedding potential is a stepwise 
function. Thus, the minimization requires some tricks to ensure its continuity.
To make it simpler, we slightly modified Equation \ref{eq:zjw04_embed}:
\begin{align}
\label{eq:zjw04xc_embed}
F(\rho) 
= & c_1 \cdot
\sum_{i=0}^{3}{F_{ni}\left( \frac{\rho}{\rho_n} - 1 \right)^{i}} \nonumber \\
+ & c_2 \cdot 
\sum_{i=0}^{3}{F_{i}\left( \frac{\rho}{\rho_e} - 1 \right)^{i}} \nonumber \\
+ & c_3 \cdot
F_{e}\left[1 - \eta\ln\left( \frac{\rho}{\rho_s}\right)\right]
(\frac{\rho}{\rho_s})^{\eta} \\
\label{eq:frho_c1}
c_{1} = & \frac{1}{1 + e^{-2\left(\rho_{n} - \rho\right)}} \\
\label{eq:frho_c3}
c_{3} = & \frac{1}{1 + e^{-2\left(\rho - \rho_{0}\right)}} \\
c_{2} = & 1 - c_1 - c_3
\end{align}
The new equation can be minimized without considering about boundary continuity.
$\omega_1$ and $\omega_3$ are just damping factors calculated by the sigmoid 
functions (Equations \ref{eq:frho_c1} and \ref{eq:frho_c3}).

The dipole ($\mu_{ab}$) and quadrupole ($\lambda_{ab}$) functions have the same 
form (developed by Mishin):
\begin{align}
\label{eq:adp_dipole}
\mu_{ab}(r) & = \left[
    d_{1}^{ab} \exp\left( -d_{2}^{ab}r \right) + d_{3}^{ab}
\right] \psi\left( \frac{r - r_{0}}{r_{h}} \right) \\
\omega_{ab}(r) & = \left[
    q_{1}^{ab} \exp\left( -q_{2}^{ab}r \right) + q_{3}^{ab}
\right] \psi\left( \frac{r - r_{0}}{r_{h}} \right)
\end{align}
where $d_{i}$, $q_{i}$, $r_0$ and $r_{h}$ are trainable parameters and $\psi(x)$
is a damping function:
\begin{equation}
\label{eq:mishin_cutoff}
\psi(x) = \begin{cases}
    0 & x \ge 0 \\
    \frac{x^4}{1 + x^4} & x < 0 
\end{cases}
\end{equation}

% -----------
% Section 2.2 Transformation
% -----------
\subsection{Transformation}
\label{sec:transformation}

To integrate EAM/ADP with machine learning, the original total energy expression 
(Equation \ref{eq:eam_total_energy}) must be transformed to a vectorizable form. 
Without loss of generality, we take a binary alloy, AB, to demonstrate how to 
derive this equation.

\newcommand{\niaa}{N_{i}^{\mathrm{AA}}}
\newcommand{\niab}{N_{i}^{\mathrm{AB}}}
\newcommand{\nibb}{N_{i}^{\mathrm{BB}}}
\newcommand{\niba}{N_{i}^{\mathrm{BA}}}
\newcommand{\riaa}{\vec{\mathbf{r}}_{i}^{\mathrm{AA}}}
\newcommand{\riab}{\vec{\mathbf{r}}_{i}^{\mathrm{AB}}}
\newcommand{\ribb}{\vec{\mathbf{r}}_{i}^{\mathrm{BB}}}
\newcommand{\riba}{\vec{\mathbf{r}}_{i}^{\mathrm{BA}}}
\newcommand{\namax}{N_{\mathrm{A}}^{\mathrm{max}}}
\newcommand{\nbmax}{N_{\mathrm{B}}^{\mathrm{max}}}
\newcommand{\nnl}{N_{\mathrm{nl}}}

The energy of atom $i$ of specie $A$ can be calculated with the following 
expanded equation (the cutoff radius $r_c$ is fixed):
\begin{align}
\label{eq:e_atom_phase_1}
E_{i}^{A} 
= & 
\frac{1}{2}\sum_{j\neq i}^{\niaa}\phi_{\mathrm{AA}}(r_{ij}) +
\frac{1}{2}\sum_{j\neq i}^{\niab}\phi_{\mathrm{AB}}(r_{ij}) \nonumber \\
+ & F_{\mathrm{A}}\left(
    \sum_{j\neq i}^{\niaa}{\rho_{\mathrm{A}}(r_{ij})} +
    \sum_{j\neq i}^{\niab}{\rho_{\mathrm{B}}(r_{ij})} 
\right)
\end{align}
where $\niaa$ represents the number of neighors of specie $A$ of atom $i$ and 
$\niab$ represents the number of neighors of specie $B$. $E_{i}^{B}$ has a 
similar expression. For each atom, we can calculate its $\niaa$ and $\niab$. 
Thus, we can find the maximum neighor list size $\nnl$:
\begin{equation}
\label{eq:nnl}
\nnl = \max{\left(
    \max\left({\niaa}\right), 
    \max\left({\niab}\right),
    \max\left({\nibb}\right)
\right)}
\end{equation}
$\nnl$ is a constant during training because both the dataset and $r_c$ are 
fixed.

Assume $H(x)$ represents the heaviside step function:
\begin{equation}
\label{eq:heaviside}
H(x) = \begin{cases}
    1 & x > 0 \\
    0 & x \leq 0 \\
\end{cases}
\end{equation}
Then,
\begin{align}
\sum_{j\neq i}^{\niaa}\phi_{\mathrm{AA}}(r_{ij}) = &
\sum_{j\neq i}^{\niaa}\phi_{\mathrm{AA}}(r_{ij}) \cdot 1 + 
\sum_{j\neq i}^{\nnl - \niaa}\phi_{\mathrm{AA}}(0) \cdot 0 \nonumber \\
= & \phi_{\mathrm{AA}}(\vec{\mathbf{r}}_{i}^{\mathrm{AA}})^T
H(\vec{\mathbf{r}}_{i}^{\mathrm{AA}})
\end{align}
where $\vec{\mathbf{r}}_{i}^{\mathrm{AA}}$ is a $\nnl$-length column vector 
whose last $\nnl - \niaa$ elements are padding zeros.

We can write Equation \ref{eq:e_atom_phase_1} in an equivalent expression:
\begin{align}
E_{i}^{\mathrm{A}} 
\label{eq:e_atom_A}
= &
\frac{1}{2}\left( 
    \phi_{\mathrm{AA}}(\vec{\mathbf{r}}_{i}^{\mathrm{AA}})^T
    H(\vec{\mathbf{r}}_{i}^{\mathrm{AA}}) +
    \phi_{\mathrm{AB}}(\vec{\mathbf{r}}_{i}^{\mathrm{AB}})^T
    H(\vec{\mathbf{r}}_{i}^{\mathrm{AB}})
\right) \nonumber \\
+ &
F_{\mathrm{A}}\left( 
    \rho_{\mathrm{AA}}(\vec{\mathbf{r}}_{i}^{\mathrm{AA}})^T
    H(\vec{\mathbf{r}}_{i}^{\mathrm{AA}}) +
    \rho_{\mathrm{AB}}(\vec{\mathbf{r}}_{i}^{\mathrm{AB}})^T
    H(\vec{\mathbf{r}}_{i}^{\mathrm{AB}})
\right)
\end{align}
Here $\vec{\mathbf{r}}_{i}^{\mathrm{AB}}$ is also a $\nnl$-length vector. For 
atom $j$ of specie $B$, we can also derive its energy $E^{\mathrm{B}}_{j}$:
\begin{align}
E_{j}^{\mathrm{B}}
\label{eq:e_atom_B}
= &
\frac{1}{2}\left( 
    \phi_{\mathrm{BB}}(\vec{\mathbf{r}}_{j}^{\mathrm{BB}})^T
    H(\vec{\mathbf{r}}_{j}^{\mathrm{BB}}) +
    \phi_{\mathrm{BA}}(\vec{\mathbf{r}}_{j}^{\mathrm{BA}})^T
    H(\vec{\mathbf{r}}_{j}^{\mathrm{BA}})
\right) \nonumber \\
+ &
F_{\mathrm{A}}\left( 
    \rho_{\mathrm{BB}}(\vec{\mathbf{r}}_{j}^{\mathrm{BB}})^T
    H(\vec{\mathbf{r}}_{j}^{\mathrm{BB}}) +
    \rho_{\mathrm{BA}}(\vec{\mathbf{r}}_{j}^{\mathrm{BA}})^T
    H(\vec{\mathbf{r}}_{j}^{\mathrm{BA}})
\right)
\end{align}

Since $\riaa$, $\riab$, $\ribb$ and $\riba$ all have the same length ($\nnl$), 
we can use a (redundant) matrix, $\mathbf{g}_{i}$, to describe all neighbors of 
atom $i$:
\begin{equation}
\mathbf{g}_i = \begin{bmatrix}
    \riaa & \riab & \ribb & \riba \\
\end{bmatrix}
\end{equation}
$\mathbf{g}_i$ is a $\nnl \times 4$ matrix. If the specie of atom $i$ is A, only
the first two columns have non-zero values. Similarly, the last two columns will
have non-zeros values if atom $i$ is a B-type atom. In fact, $\mathbf{g}_i$ can
be viewed as the EAM descriptors for atom $i$. Hence, each structure can be 
expressed with a 3D matrix, $\mathbf{G}$ , of shape $N \times \nnl \times 4$.

During the training phase, the maximum appearances of element A and B in any 
structure ($\namax$ and $\nbmax$) are also constants. Thus, any $\mathbf{G}$ can 
be expanded to a $(\namax + \nbmax) \times \nnl \times 4$ matrix, $\mathbf{G}'$, 
with zero-padding. As $\mathbf{G}'$ is a fixed-shape matrix and $\rho(r)$, 
$\phi(r)$ and $F(\rho)$ are all elementwise functions, we can use any modern 
machine learning platform (TensorFlow, PyTorch, MXNet, etc) to implement the EAM 
model. In this paper, we chose TensorFlow as our coding framework. Based on the 
virtual atom approach, we successfully designed a route to build the machine 
learning computation graph directly from positions to total energy. Thus, 
analytically-derived EAM force and virial stress can be calculated without pain.
\begin{align}
\label{eq:forces}
f_{i} = & -\frac{\partial E^{total}}{\partial r_{i}} \\
\label{eq:stress}
V \cdot \epsilon = & -\mathbf{F}^{T}\mathbf{R} + \left(
    \frac{\partial E^{total}}{\partial \mathbf{h}}
\right)^T \mathbf{h}
\end{align}
where $V$ is the volume, $\epsilon$ is the $3 \times 3$ virial stress tensor, 
$\mathbf{h}$ is the \textit{row-major} $3 \times 3$ lattice tensor, $\mathbf{F}$ 
and $\mathbf{R}$ are $N \times 3$ matrices representing the total forces and 
atomic positions. 
The derivation of Equation \ref{eq:stress} has been published elsewhere. The 
details of the virtual atom approach can be found in the appendix. The last step 
is to find optimal parameters. This can be done by minimizing the mini-batch 
loss function:
\begin{align}
\label{eq:loss}
\mathbf{Loss} & = \sqrt{\frac{1}{N_{b}}\sum_{i=1}^{N_{b}}{\left(
    E_{i} - E_{i}^{\mathrm{dft}}
\right)^2}} \nonumber \\
& + \chi_{\mathrm{f}}\sqrt{
    \frac{1}{3\sum_{i}^{N_{b}}{N_i}}\sum_{i}^{N_b}{\sum_{j}^{N_i}{
        \sum_{\alpha}{
            \left(f_{ij\alpha} - f_{ij\alpha}^{\mathrm{dft}}\right)^2
        }
    }}
} \nonumber \\
& + \chi_{\mathrm{s}}\sqrt{\frac{1}{6N_b}\sum_{i}^{N_b}{
    \sum_{j}^{6}{
        \left(
            \epsilon^{\mathrm{voigt}}_{j} - \epsilon^{\mathrm{voigt,dft}}_{j}
        \right)^2
    }
}} 
\end{align} 
where $N_{b}$ is the batch size and $N_i$ is the number of atoms in structure 
$i$. The superscript 'voigt' means that stress tensors should be converted to 
Voigt form. The Adam optimizer is used to minimize Equation \ref{eq:loss}. 
In most cases, we use 0.01 as the initial learning rate and the batch size 
ranges from 20 to 50. 

% -----------
% Section 2.3 Implementation
% -----------
\subsection{Implementation}
\label{sec:implementation}

% -----------
% Section 2.4 Constraints
% -----------
\subsection{Constraints}
\label{sec:constraints}

The Rose constraint incoporates the universal equation of state (Rose et al) 
into the total loss function. The Mishin-modified equation 
\begin{equation}
\label{eq:rose_eos}
E(y) = E_{0}\left[
    1 + \alpha x + \beta \alpha^3 x^3 \frac{2x + 3}{(x - 1)^2} \right]
    e^{-\alpha x}
\end{equation}
is used because the original form tends to underestimate energies under high 
pressures. In Equation \ref{eq:rose_eos}, $E_{0}$ is the energy of the 
equilibrium structure, $x = a / a_{0} - 1$ is the relative isotropic scaling 
factor ($a$ is the lattice constant), $\beta$ is a chosen parameter and 
\begin{equation}
\label{eq:rose_alpha}
\alpha = \sqrt{-\frac{9 V_{0} B }{E_{0}}}
\end{equation}
where $V_0$ is the equilibrium volume and $B$ is the bulk modulus. The adoption
of the Rose constraint guarantees the exact prediction of the bulk modulus and 
the energy-volume curve. The loss of the Rose EOS constraint 
$\mathbf{L}^{\mathrm{Rose}}$  is measured as the 2-norm of the energy 
differences between $E(x)^{\mathrm{Rose}}$ and their corresponding predicted 
$E(x)$: 
\begin{equation}
\label{eq:rose_loss}
\mathbf{L}^{\mathrm{Rose}} =
\sum_{i}{\mathbf{RMSE}(E_{i}(x), E_{i}(x)^{\mathrm{Rose}})}
\end{equation}

In this work, for each included crystal, we use the same choices of $x$: 
$x_{t} = x_{0} + \Delta x \cdot t, x_{0} = -0.1, N_{t}^{\mathrm{max}} = 20, 
\Delta x=0.01$.

Elastic constraints are common metrics for tuning empirical potentials. In the
ML framework, fitting elastic constants of specific crystals is also possible.
The elastic constant $c_{ijkl}$ can be derived from $E^{total}$ directly:
\begin{equation}
\label{eq:cijkl}
c_{ijkl} |_{\epsilon \to 0, \mathbf{F} \to 0} = \frac{1}{V}\left[
    \left( 
        \frac{\partial{\epsilon_{ij}}}{\partial{\mathbf{h}}}
    \right)^{\mathrm{T}}\mathbf{h}
\right]_{kl}
\end{equation}
In this work, the loss $\mathbf{L}^{\mathrm{elastic}}$ contributed by the 
elastic constraint is also measured by the RMSE between $c_{ijkl}$ and 
$c_{ijkl}^{\mathrm{dft}}$:
\begin{align}
\label{eq:cijkl_loss}
\mathbf{L}^{\mathrm{elastic}} 
& = \sum_{i}{c_{i} \cdot \mathbf{RMSE_{i}} + {|\epsilon|} + {|\mathbf{F}|}} \\
\label{eq:cijkl_loss_gate}
c_{i} & = \mathbf{ReLU}(\mathbf{MAE_{i}} - \tau) \\
\label{eq:relu}
\mathbf{ReLU}(x) & = \begin{cases}
    x & x \ge 0 \\
    0 & x < 0
\end{cases}
\end{align}
where $\sum_{i}$ loops through all included crystals, $\mathbf{MAE}$ is the mean 
absolute error and $\tau$ is a pre-selected gate parameter. When $\mathbf{MAE}$ 
is below $\tau$, $\mathbf{L}^{\mathrm{elastic}}$ will not contribute to the 
total loss. In this work, $\tau$ is set to 1 GPa.


% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% 
% Section 3. Results
%
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\section{Results and Discussions}
\label{sec:results}

The publicly available Ni-Mo dataset is use to demonstrate our ML-EAM approach. 
This dataset is built by Shyue Ping Ong and co-workers. It contains 3973 unique
Ni-Mo solids, including 373 elemental Ni and 284 elemental Mo. DFT calculations 
were done by VASP at the PBE level with projector augmented-wave approach.

Table \ref{table:parameters} shows the optimization results. All these 
minimization tasks include energy, force and stress terms in their total losses.
The $\chi_{\mathrm{f}}$ in Equation \ref{eq:loss} is set to 10 and 
$\chi_{\mathrm{s}}$ is fixe to 80. In this paper, the superscript tag 'old' 
denotes the original Zjw04, 'res' means restricted optimization and 'unres' 
means unrestricted optimization. Here 'unrestricted' indicates the parameter 
$r_e$ will be treated as a common adjustable variable.

Table \ref{table:MAE} demonstrates the prediction errors of the machine learned
EAM models and reference models. 

\begin{table*}[h]
\centering
\begin{tabular}{lcccccccc}
\hline
    & Ni$^{\mathrm{old}}$ & Ni & Ni$^{\mathrm{alloy}}$ 
    & Mo$^{\mathrm{old}}$ & Mo & Mo$^{\mathrm{alloy}}$ \\
\hline
$r_e$ & 2.488746 & 2.124480 & & 2.728100 & & \\
$f_e$ & 2.007018 & 2.633256 & & 2.723710 & & \\
$\rho_e$ & 27.562015 & 27.233315 & \\ 
$\rho_s$ & 27.930410 & 26.392414 &\\
$\alpha$ & 8.383453 & 8.452753 & \\
$\beta$ & 4.471175 & 3.285651 & \\
$A$ & 0.429046 & 0.9802988 & \\
$B$ & 0.633531 & 0.8919016 & \\
$\kappa$ & 0.443599 & 0.5685785 & \\
$\lambda$ & 0.820658 & 1.1653832 & \\
$F_{n0}$ & -2.693513 & -3.4354472 & \\
$F_{n1}$ & -0.076445 & 0.3544341 & \\
$F_{n2}$ & 0.241442 & -2.5563858 & \\
$F_{n3}$ & -2.375626 & -7.1984844 & \\
$F_{0}$ & -2.70 & -3.236908 & \\
$F_{1}$ & 0 & 1.4576268 & \\
$F_{2}$ & 0.265390 & 2.1785288 & \\
$F_{3}$ & -0.152856 & -1.642411 & \\
$\eta$ & 0.469000 & 4.305329 & \\
$F_e$ & -2.699486 & -3.6163342 & \\
\hline
\end{tabular}
\caption{\label{table:parameters} The original (labeled as 'old'), elemental and 
alloy parameters.}
\end{table*}

\begin{table*}[h]
\centering
\begin{tabular}{lcccccccc}
\hline
    & Model & Mo & Ni$_4$Mo & Ni$_3$Mo & Ni$_{\mathrm{Mo}}$ & Mo$_{\mathrm{Ni}}$ 
    & Ni & Overall \\
\hline
Energy (meV/atom) & SNAP & 16.2 & 4.0 & 5.2 & 22.7 & 33.9 & 7.9 & 22.5 \\
    & EAM & 58.9 & 211.2 & 255.6 & 46.5 & 147.6 & 10.6 & 117.2 \\
    & \color{red} ML-EAM & \color{red} 45.0 & \color{red} 10.6 
    & \color{red} 7.1 & \color{red} 39.0 & \color{red} 29.8 & \color{red} 10.4 
    & \color{red} 27.4 \\
    & NN (esf) & 30.0 & 6.1 & 9.0 & 16.6 & 26.2 & 7.8 & 19.1 \\
\hline
Force (eV/\AA) & SNAP & 0.29 & 0.14 & 0.16 & 0.13 & 0.55 & 0.11 & 0.23 \\
& EAM & 0.31 & 0.20 & 0.19 & 0.21 & 0.57 & 0.06 & 0.26 \\
& \color{red} ML-EAM & \color{red} 0.31 & \color{red} 0.17 & \color{red} 0.15 
& \color{red} 0.23 & \color{red} 0.18 & \color{red} 0.09 & \color{red} 0.17 \\
& NN (esf) & 0.36 & 0.10 & 0.11 & 0.08 & 0.16 & 0.06 & 0.12 \\
% \hline
% Stress (GPa) & Mo SNAP & \textbf{0.87} & & & & & & \\
% & Mo SFNN & 1.00 & & & & & & \\
% & Ni-Mo SFNN & 5.77 & \textbf{1.72} & 1.74 & 1.45 & 3.75 & 1.97 & 2.83 \\
% & Ni-Mo SFNN (esf) & \textbf{1.84} & 2.05 & \textbf{1.38} & \textbf{0.57} & 
%     \textbf{1.22} & \textbf{1.91} & \textbf{1.27} \\
\hline
\end{tabular}
\caption{\label{table:MAE}
Comparion of the MAEs in predicted energies (mev/atom) and forces (eV/\AA) 
relative to DFT.}
\end{table*}

\begin{table*}[h]
\centering
\begin{tabular}{lccccc}
\hline
    & DFT & Ni-Mo SNAP & ML-EAM & EAM & Experiment \\
\hline
Mo \\
$c_{11}$ & 472 & 475 (0.6\%) & 477 (1.1\%) & 457 (-3.2\%) & 479 \\
$c_{12}$ & 158 & 163 (3.2\%) & 166 (5.1\%) & 168 (6.3\%) & 165 \\
$c_{44}$ & 106 & 111 (4.7\%) & 101 (-4.7\%) & 116 (9.4\%) & 108 \\
$B_{\mathrm{VRH}}$ & 263 & 267 (1.5\%) & 270 (2.7\%) & 264 (0.4\%) & 270 \\
$G_{\mathrm{VRH}}$ & 124 & 127 (2.4\%) & 127 (2.4\%) & 127 (2.4\%) & 125 \\
$\mu$ & 0.30 & 0.29 (-3.3\%) & 0.31 (3.3\%) & 0.29 (-3.3\%) & 0.30 \\
\hline
Ni \\
$c_{11}$ & 276 & 269 (-2.5\%) & 268 (-2.9\%) & 248 (-10.1\%) & 261 \\
$c_{12}$ & 159 & 150 (-5.7\%) & 165 (3.8\%) & 147 (-7.5\%) & 151 \\
$c_{44}$ & 132 & 135 (2.3\%) & 116 (-12.1\%) & 125 (-5.3\%) & 132 \\
$B_{\mathrm{VRH}}$ & 198 & 190 (-4.0\%) & 200 (1.0\%) & 181 (-8.6\%) & 188 \\
$G_{\mathrm{VRH}}$ & 95 & 97 (2.1\%) & 84 (-11.6\%) & 87 (-8.4\%) & 479 \\
$\mu$ & 0.29 & 0.28 (-3.4\%) & 0.31 (6.8\%) & 0.29 (0.0\%) & 0.29 \\
\hline
Ni$_3$Mo \\
$c_{11}$ & 385 & 420 (9.1\%) & 430 (11.7\%) & 195 (-49.4\%) & \\
$c_{12}$ & 166 & 197 (18.7\%) & 187 (12.7\%) & 98 (-41.0\%) & \\
$c_{13}$ & 145 & 162 (11.7\%) & 180 (24.1\%) & 98 (-32.4\%) & \\
\color{blue} $c_{23}$ & 131 & 145 (10.7\%) & 210 (60.3\%) & 107 (-18.3\%) & \\
$c_{22}$ & 402 & 360 (-10.4\%) & 457 (13.7\%) & 98 (-75.6\%) & \\
\color{blue} $c_{33}$ & 402 & 408 (-1.5\%) & 412 (2.5\%) & 295 (-26.6\%) & \\
\color{blue} $c_{66}$ & 94 & 84 (-10.5\%) & 27 (-71.3\%) & 36 (-61.7\%) & \\
$B_{\mathrm{VRH}}$ & 230 & 243 (5.7\%) & 280 (21.7\%) & 156 (-32.2\%) &  \\
$G_{\mathrm{VRH}}$ & 89 & 100 (12.4\%) & 66 (-25.8\%) & 61 (-31.5\%) & \\
$\mu$ & 0.33 & 0.32 (-3.0\%) & 0.39 (18.2\%) & 0.33 (0.0\%) & \\
\hline
Ni$_4$Mo \\
$c_{11}$ & 300 & 283 (-5.7\%) & 278 (-7.3\%) & 172 (-42.7\%) & \\
$c_{12}$ & 186 & 179 (-3.8\%) & 184 (-1.1\%) & 158 (-15.1\%) & \\
$c_{22}$ & 313 & 326 (4.2\%) & 278 (-11.2\%) & 158 (-49.5\%) & \\
\color{blue} $c_{23}$ & 166 & 164 (-1.2\%) & 230 (38.6\%) & 80 (-51.8\%) & \\
\color{blue} $c_{66}$ & 130 & 126 (-3.1\%) & 87 (-33.1\%) & 125 (-3.8\%) & \\
$B_{\mathrm{VRH}}$ & 223 & 220 (-1.3\%) & 233 (10.5\%) & 161 (-27.8\%) & \\
$G_{\mathrm{VRH}}$ & 91 & 95 (4.4\%) & 57 (37.4\%) & -156 (-162\%) & \\
$\mu$ & 0.33 & 0.31 (-6.1\%) & 0.39 (18.2\%) & 0.70 (112\%) & \\
\hline
\end{tabular}
\caption{\label{table:NiMo_elastic_constants}
Comparion of elastic constants ($c_{ij}$, GPa), Voigt-Reuss-Hill bulk modulus 
($B_{\mathrm{VRH}}$, GPa), Voigt-Reuss-Hill shear modulus ($G_{\mathrm{VRH}}$, 
GPa) and homogeneous Poisson's ratio ($\mu$) for fcc Ni, fcc Mo and binary 
alloys Ni$_{3}$Mo and Ni$_{4}$Mo.
}
\end{table*}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% 
% Section 4. Discussions
%
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\section{Discussions}
\label{sec:discussions}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% 
% Section 5. Conclusions
%
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\section{Conclusions}
\label{sec:conclusions}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% 
% Acknowlegements
%
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\section*{Acknowledgments}
\label{sec:acknowledgments}

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% 
% References
%
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\bibliography{manuscript.bib}

\end{document}